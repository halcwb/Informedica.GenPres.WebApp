Ext.define("GenPres.controller.Main",{extend:Ext.app.Controller});Ext.define("GenPres.session.PatientSession",{currentLogicalUnitId:0,currentLogicalUnitName:"",singleton:true,patient:{PID:""},setLogicalUnit:function(b,a){this.currentLogicalUnitId=b;this.currentLogicalUnitName=a},getLogicalUnitId:function(){return this.currentLogicalUnitId},getLogicalUnitName:function(){return this.currentLogicalUnitName},setPatient:function(a){this.patient.PID=a.data.PID}});Ext.define("GenPres.view.main.MainViewLeft",{extend:Ext.Panel,layout:"vbox",region:"west",xtype:"panel",border:false,autoScroll:true,layout:{type:"vbox",align:"stretch"},width:300,split:true,margins:"0 0 0 0",initComponent:function(){var a=this;a.items=[{xtype:"box",border:false,html:'<div style="text-align:center"><img src="ClientApplications/Styles/GenPres/images/logo.png" style="margin-top:22px;" /></div>',height:82},Ext.create("GenPres.view.main.PatientTree",{name:"mainPatientTree"})];a.callParent()}});Ext.define("GenPres.controller.patient.Patient",{extend:Ext.app.Controller,alias:"widget.patientcontroller",views:["login.LoginWindow"],logicalUnitId:null,init:function(){this.control({treepanel:{beforeitemclick:this.checkRootNode,itemclick:this.loadPatientData},patientlist:{select:this.loadPatientData,render:this.loadPatientList}})},hoverItem:function(b,a,f,c,g,d){extItem=Ext.get(f);extItem.animate({easing:"easeIn",duration:50,to:{backgroundColor:"#fff",color:"#3892D3"}})},unhoverItem:function(b,a,f,c,g,d){extItem=Ext.get(f);extItem.animate({easing:"easeIn",duration:1,to:{backgroundColor:"#3892D3",color:"#fff"}})},loadPatientList:function(a){a.store.proxy.extraParams.logicalUnit=this.logicalUnitId;a.store.reload()},checkRootNode:function(a,b,h,d,f,c){if(d==0){var g=this.getPatientPatientInfoStoreStore();var e=this.getTreePanel();if(typeof(g.getAt(0))!="undefined"){e.selModel.select(g.getAt(0))}return false}},loadPatientData:function(a,b,g,d,e,c){var f=GenPres.application.getController("prescription.PrescriptionController");f.loadPrescriptionForm()},setPatientWeight:function(b){var a=this.getPrescriptionPatientComponent();a.down("unitvaluefield[name=patientWeight]").setValue(b)},setPatientLength:function(a,c){var b=this.getPrescriptionPatientComponent();b.down("unitvaluefield[name=patientLength]").setValue(a)},getPrescriptionPatientComponent:function(){return GenPres.application.MainCenter.query("prescriptionpatient")[0]},getGridPanel:function(){return GenPres.application.MainCenter.query(".prescriptiongrid")[0]},setLogicalUnitId:function(b){var a=this;a.logicalUnitId=b},getLogicalUnitId:function(){var a=this;return a.logicalUnitId},getTreePanel:function(){return GenPres.application.viewport.query(".patienttree")[0]}});Ext.define("GenPres.controller.login.Login",{extend:Ext.app.Controller,alias:"widget.logincontroller",views:["login.LoginWindow"],loggedIn:false,loginWindow:null,init:function(){var a=this;this.control({"window button[text=Login]":{click:a.onClickValidateLogin},"button[action=registerdatabase]":{click:a.showRegisterDatabaseWindow},'window[title="Registreer Database"] button[action=save]':{click:a.onClickSaveDatabaseRegistration},dataview:{itemclick:function(c,b,f,d,e){var g=a.getController("GenPres.controller.patient.Patient");g.setLogicalUnitId(b.data.Id)}}})},getLoginWindow:function(){var b=this,a;a=b.getLoginLoginWindowView().create();return a},setDefaultDatabase:function(b){var c,a=Ext.create("GenPres.lib.util.QueryHelper");c=Ext.ComponentQuery.query("window[title="+b.title+"] combobox[name=database]")[0]},onClickValidateLogin:function(a){var d,b,c;d=a.up("window");this.loginWindow=d;b=d.down("form");c=b.getValues();this.validateLogin(c)},validateLogin:function(a){if(this.validateLoginForm(a)){Login.Authenticate(a.username,a.password,this.loginCallBackFunction,this)}},validateLoginForm:function(c){var a="";if(c.username==""){a+="Selecteer aub een gebruikersnaam<br />"}if(c.password==""){a+="Selecteer aub een wachtwoord<br />"}var b=this.getController("GenPres.controller.patient.Patient");if(b.getLogicalUnitId()==null){a+="Selecteer aub een afdeling\n"}if(a!=""){Ext.MessageBox.alert("GenPres 2011 Login Error",a)}return a==""},loginCallBackFunction:function(a){var b=this;b.processAuthentication(a.success)},processAuthentication:function(a){var b=this;b.loggedIn=a;if(a){b.closeLoginWindow();GenPres.application.getViewPort()}else{Ext.MessageBox.alert("GenPres 2011 Login","Login geweigerd")}},closeLoginWindow:function(){var a=this;a.loginWindow.close()},showRegisterDatabaseWindow:function(){var a=this;a.createRegisterDatabaseWindow().show()},createRegisterDatabaseWindow:function(){var a=this;return a.getDatabaseRegisterDatabaseWindowView().create()},onClickSaveDatabaseRegistration:function(a){var b=this;Database.SaveDatabaseRegistration(b.getWindowFromButton(a).getDatabaseName(),b.getWindowFromButton(a).getMachineName(),b.getWindowFromButton(a).getGenPresConnectionString(),b.getWindowFromButton(a).getPDMSConnectionString(),b.getWindowFromButton(a).getGenFormWebservice(),b.onDatabaseRegistrationSaved);b.getWindowFromButton(a).close()},getWindowFromButton:function(a){return a.up().up()},onDatabaseRegistrationSaved:function(a){var b=this;if(a.success){Ext.MessageBox.alert("Database Registration",a.databaseName)}else{Ext.MessageBox.alert("Database Regstration","Database could not be registered")}}});Ext.define("GenPres.view.Main",{extend:Ext.Component,html:"Hello, World!!"});Ext.define("GenPres.view.login.LogicalUnitSelector",{extend:Ext.view.View,alias:"widget.logicalunitselector",margin:"20 0 0 16",itemSelector:"div.LogicalUnitDataViewItem",emptyText:"No logical units found",singleSelect:true,autoScroll:true,store:Shared.util.StoreManager.GetStore("LogicalUnitDto",Login.GetLogicalUnits,{},{autoLoad:true,sorters:[{property:"Name",direction:"ASC"}]}),tpl:new Ext.XTemplate('<tpl for="."><div class="LogicalUnitDataView">','<div class="LogicalUnitDataViewItem">',"{Name}","</div>","</div></tpl>"),initComponent:function(){var a=this;a.callParent()}});Ext.define("GenPres.view.login.LoginWindow",{extend:Ext.Window,alias:"widget.userlogin",bodyPadding:5,closable:false,title:"GenPres Login",defaultDatabase:"Default Database",initComponent:function(){var a=this;Ext.applyIf(a,{mixins:{process:"Shared.util.Process"}});a.dockedItems=a.createDockedItems();a.items=this.createItems();a.callParent(arguments)},Processes:{Login:[{component:"form",text:"Dit formulier kan gebruikt worden om in te loggen."},{component:"form textfield[name=username]",text:"Vul uw gebruikersnaam in."},{component:"form textfield[name=password]",text:"Vul uw wachtwoord in."},{component:"toolbar button[action=login]",text:"Klik op de login button om de applicatie te starten."}]},getLoginButton:function(){return Ext.ComponentQuery.query("toolbar button[action=login]")},createDockedItems:function(){return[{xtype:"toolbar",dock:"bottom",items:["->",{text:"Login",action:"login"}]}]},createItems:function(){var a=this;return[a.getHtmlImage(),a.getLoginForm2()]},afterRender:function(){this.callParent(arguments)},getImagePath:function(){return"/GenPres/ClientApplications/Styles/GenPres/Images/MedicalBanner.jpg"},getHtmlImage:function(){var b=this,a=b.getImagePath();return{html:"<img src="+a+" />",height:180,xtype:"box"}},getLoginForm2:function(){var a=this;return{xtype:"form",border:false,bodyPadding:15,width:541,defaults:{allowBlank:false},items:[{xtype:"textfield",fieldLabel:"Gebruikersnaam",name:"username",margin:"10 0 10 10",value:"peter"},{xtype:"textfield",inputType:"password",fieldLabel:"Wachtwoord",name:"password",margin:"0 0 10 10",value:"test"},Ext.create("GenPres.view.login.LogicalUnitSelector",{name:"loginLogicalUnitSelector"})]}},advancedLoginFieldSet:function(){var a=this;return{xtype:"fieldset",layout:"hbox",collapsible:true,collapsed:true,margin:"65 0 0 0",items:[a.createDatabaseCombo(),a.createRegisterDatabaseButton()]}},createDatabaseCombo:function(){var a=this;return{xtype:"combo",name:"database",fieldLabel:"Database",displayField:"DatabaseName",store:a.getDatabaseStore()}},getDatabaseStore:function(){return""},createRegisterDatabaseButton:function(){return{xtype:"button",text:"Registreer Database",action:"registerdatabase"}}});Ext.define("GenPres.view.main.MainView",{extend:Ext.Panel,layout:"fit",border:false,constructor:function(){var a=this;a.callParent(arguments)},initComponent:function(){var a=this;a.items=[];a.callParent();return a}});Ext.define("GenPres.view.main.MainViewCenter",{extend:Ext.Panel,region:"center",xtype:"panel",border:false,layout:"border",initComponent:function(){var a=this;a.items=[Ext.create("GenPres.view.main.MainViewCenterContainer"),Ext.create("GenPres.view.prescription.PrescriptionTabs")];GenPres.application.MainCenter=this;a.callParent()},height:100,split:true});Ext.define("GenPres.view.main.MainViewCenterContainer",{extend:Ext.Panel,region:"center",xtype:"panel",activeItem:0,border:false,layout:"card",initComponent:function(){var a=this;a.items=[{id:"card-0",xtype:"box",html:"<br /><br /><h1>&nbsp;&nbsp;&nbsp;Welkom bij GenPres - Development version</h1>",border:false}];a.dockedItems=Ext.create("GenPres.view.main.TopToolbar");GenPres.application.MainCenterContainer=this;a.callParent()},height:100,split:false,margins:"0 0 0 0"});Ext.define("GenPres.view.main.PatientInfo",{extend:Ext.view.View,colspan:4,alias:"widget.patientinfo",itemSelector:"patientInfo",tpl:new Ext.XTemplate('<tpl for=".">','<div class="patientIcon"><div class="PatientInfoPid">{PID}</div></div><div class="patientNameInfo">','<b><span style="font-size:12px;">{LastName}, {FirstName}</span></b><br />','<div class="patientInfoValue">','<div class="patientInfoHeader"><b>Afdeling/bed:</b> {Unit} - {Bed}</div><br />','<div class="patientInfoHeader"><b>Opname: {RegisterDate}</b></div><br />','<div class="patientInfoHeader"><b>Ligdag: {Days}</b></div>',"</div>","</div>","</tpl>"),store:"patient.PatientInfoStore",initComponent:function(){var a=this;a.callParent()}});Ext.define("GenPres.view.main.PatientTree",{extend:Ext.view.View,alias:"widget.patientlist",margin:"0 0 0 0",itemSelector:"div.PatientViewItem",emptyText:"No logical units found",singleSelect:true,autoScroll:true,padding:"4 4 4 4",store:Shared.util.StoreManager.GetStore("PatientDto",Patient.GetPatientsByLogicalUnit,{logicalUnit:"26240f04-310b-4e1a-be77-7986dea8aff3"},{autoLoad:false}),tpl:new Ext.XTemplate('<tpl for="."><div class="PatientView">','<div class="PatientViewItem">',"{FirstName}&nbsp;{LastName}","</div>","</div></tpl>"),initComponent:function(){var a=this;a.callParent()}});Ext.define("GenPres.view.main.ToolbarButton",{extend:Ext.button.Button,text:"",scale:"small",location:"ClientApplications/Styles/GenPres/images/TopToolbar/",iconAlign:"left",disabled:false,width:60,initComponent:function(){var a=this;a.icon=a.location+a.icon;a.callParent()}});Ext.define("GenPres.view.main.TopToolbar",{extend:Ext.container.ButtonGroup,dock:"top",initComponent:function(){var a=this;a.items=[{xtype:"buttongroup",columns:5,title:"Algemeen",items:[Ext.create("GenPres.view.main.ToolbarButton",{icon:"Home_32.png",text:"Home",width:80,action:"home"}),{xtype:"tbseparator",height:20},Ext.create("GenPres.view.main.ToolbarButton",{icon:"Prescription_32.png",text:"Voorschrijven",width:130}),{xtype:"tbseparator",height:20},Ext.create("GenPres.view.main.ToolbarButton",{icon:"TPN_32.png",text:"TPN",width:70})]},{xtype:"tbseparator",height:20},{xtype:"buttongroup",columns:3,title:"Opties",items:[Ext.create("GenPres.view.main.ToolbarButton",{icon:"Template_32.png",text:"Sjablonen",width:100}),{xtype:"tbseparator",height:20},Ext.create("GenPres.view.main.ToolbarButton",{icon:"NewMedicine_32.png",text:"Nieuw medicament",width:175})]},{xtype:"buttongroup",columns:1,title:"Patient informatie",height:81,width:350,items:Ext.create("GenPres.view.main.PatientInfo")},{xtype:"buttongroup",columns:1,height:81,html:"medewerker info",width:200,title:"Medewerker"}];a.callParent()}});Ext.define("GenPres.view.prescription.PrescriptionGrid",{extend:Ext.grid.Panel,border:false,alias:"widget.prescriptiongrid",title:"voorscrhiften",columns:[{header:"StartDate",dataIndex:"StartDate"},{header:"Generiek",dataIndex:"drugGeneric"}],initComponent:function(){var a=this;a.callParent()}});Ext.define("GenPres.view.prescription.PrescriptionTabs",{extend:Ext.tab.Panel,region:"south",border:false,initComponent:function(){var a=this;a.items=[Ext.create("GenPres.view.prescription.PrescriptionGrid"),{title:"Totalen",xtype:"box",html:"Under construction"},{title:"Overzicht",xtype:"box",html:"Under construction"}];a.callParent()},height:200,split:true});